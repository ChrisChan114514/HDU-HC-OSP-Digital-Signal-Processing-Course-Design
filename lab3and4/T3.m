% 定义数字带通滤波器的设计参数
Fs = 720;       % 采样频率 (Hz)
w1 = 2*Fs*tan(2*pi*60/(2*Fs)); % 计算模拟通带下截止频率 (60 Hz)，使用预扭曲公式 w' = 2*Fs*tan(ω/2)
w2 = 2*Fs*tan(2*pi*300/(2*Fs)); % 计算模拟通带上截止频率 (300 Hz)，使用预扭曲公式 w' = 2*Fs*tan(ω/2)
w4 = 2*Fs*tan(2*pi*320/(2*Fs)); % 计算模拟阻带上截止频率 (320 Hz)，使用预扭曲公式 w' = 2*Fs*tan(ω/2)
w3 = 2*Fs*tan(2*pi*40/(2*Fs));  % 计算模拟阻带下截止频率 (40 Hz)，使用预扭曲公式 w' = 2*Fs*tan(ω/2)
wp = [w1 w2];   % 模拟通带频率范围 [w1, w2]，用于后续滤波器设计
ws = [w3 w4];   % 模拟阻带频率范围 [w3, w4]，用于后续滤波器设计
Rp = 3;         % 通带最大允许纹波 (dB)
Rs = 10;        % 阻带最小衰减 (dB)

% 把模拟滤波器的参数转换为数字滤波器参数
[N, Wn] = buttord(wp, ws, Rp, Rs, 's'); % 计算巴特沃斯模拟带通滤波器的阶数 N 和归一化截止频率 Wn，'s' 表示模拟域
disp(N);        % 输出滤波器阶数 N

% 构建巴特沃斯模拟带通滤波器
[b, a] = butter(N, Wn, 's'); % 生成阶数为 N 的模拟带通滤波器，'s' 表示模拟域

% 使用双线性变换将模拟滤波器转换为数字滤波器
[bz, az] = bilinear(b, a, Fs); % 将模拟滤波器系数 (b, a) 转换为数字滤波器系数 (bz, az)，Fs 为采样频率

% 计算数字滤波器的频率响应
[H, W] = freqz(bz, az); % 计算数字滤波器的频率响应，H 为复频率响应，W 为归一化频率 (弧度/采样点)

% 显示数字滤波器的分子和分母系数
disp(bz);       % 输出数字滤波器分子多项式系数
disp(az);       % 输出数字滤波器分母多项式系数

% 绘制频率响应图
subplot(2,1,1); % 创建 2 行 1 列的子图，选择第一个子图
plot(W*Fs/(2*pi), abs(H)); % 绘制线性幅度响应，横轴为实际频率 (Hz)，W*Fs/(2*pi) 将归一化频率转换为 Hz
grid on;        % 显示网格线
xlabel('频率/Hz'); % 横轴标签
ylabel('幅度'); % 纵轴标签

subplot(2,1,2); % 选择第二个子图
plot(W*Fs/(2*pi), 20*log10(abs(H))); % 绘制 dB 幅度响应，横轴为实际频率 (Hz)
grid on;        % 显示网格线
xlabel('频率/Hz'); % 横轴标签
ylabel('幅度 (dB)'); % 纵轴标签